# vi: se ft=nginx:
#
# This file is managed by Chef; your changes will perish!

<% if node[:'met-bora-ci'][:nginx][:ssl] %>
server {
    listen 80;
    server_name <%= node[:'met-bora-ci'][:domain] %>;
    rewrite ^/(.*)$ https://<%= node[:'met-bora-ci'][:domain] %>/$1 permanent;
}
<% end %>

server {
    <% if node[:'met-bora-ci'][:nginx][:ssl] %>
    listen 443;
    ssl on;
    ssl_certificate <%= node[:'met-bora-ci'][:nginx][:ssl_cert_path] %>;
    ssl_certificate_key <%= node[:'met-bora-ci'][:nginx][:ssl_key_path] %>;
    <% else %>
    listen 80;
    <% end %>
    server_name <%= node[:'met-bora-ci'][:domain] %>;
    root /dev/null;
    access_log /var/log/nginx/<%= node[:'met-bora-ci']['domain'] %>-access.log;
    error_log /var/log/nginx/<%= node[:'met-bora-ci']['domain'] %>-error.log;

    location / {
        proxy_pass http://localhost:8153;
    }
}
